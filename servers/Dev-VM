##AH:UseTextMode
# Verify

Log-Warning $ChocolateyPackagesBuild;

set %packages = %FromJson($ChocolateyPackagesBuild);

Log-Warning $ChocolateyPackagesCommon;

set $Source = "";

# Loop over Module list to install
foreach $packageName in @MapKeys(%packages)
{
    set $packageVersion = %packages[$packageName];

    Log-Information Ensuring Chocolatey package $packageName $packageVersion;

    Chocolatey::Ensure-Package
    (
        Name: $PackageName,
        Version: $PackageVersion,
        Source: $Source
    );
}

Chocolatey::Ensure-Installed
(
    Version: latest,
    Source: https://chocolatey.org/api/v2
);

Chocolatey::Ensure-Source
(
    Name: Internal,
    Url: https://proget.local/chocolatey,
    Credential: DomainCred
);

Chocolatey::Ensure-Feature
(
    Feature: checksumFiles,
    Enabled: false
);
