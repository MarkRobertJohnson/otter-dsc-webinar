##AH:UseTextMode
##AH:Description Ensures the provided list of PowerShell modules is installed
module EnsurePowerShellModules<@PowershellModules>
{
    set @RaftPowerShellModules = @(cNtfsAccessControl, xWindowsUpdate, xWebAdministration, xStorage,
     xNetworking, ReverseDSC, xRemoteDesktopAdmin, xRemoteDesktopSessionHost, xCertificate, AzureRM.profile, SystemLocaleDsc);

    # Append modules
    foreach $ModuleName in @RaftPowerShellModules
    {
        set @PowerShellModules = @ListInsert(@PowershellModules, $ModuleName);
    }

    # Loop over Module list to install
    foreach $ModuleName in @PowershellModules
    {
        PSDsc PackagemanagementProviderresource::PackageManagement
        (
            Otter_ConfigurationKey: Name,
            Name: $ModuleName,
            Ensure: Absent
        );
    }
}
